ahoyapi: v2
commands:
  backup:
    cmd: "~/vendor/pantheon-systems/terminus/bin/terminus backup:create --keep-for 6 -- ${PWD##*/}.$1\n"
    usage: "create a backup of a single environment. \nExample: ahoy backup <environment name>\n"
  backup-all:
    cmd: "~/vendor/pantheon-systems/terminus/bin/terminus backup:create --keep-for 6 -- ${PWD##*/}.dev;
    ~/vendor/pantheon-systems/terminus/bin/terminus backup:create --keep-for 6 -- ${PWD##*/}.test;
    ~/vendor/pantheon-systems/terminus/bin/terminus backup:create --keep-for 6 -- ${PWD##*/}.live"
    usage: "create a backup of a dev, test and live. This takes quite a while to perform. \nExample: ahoy backup-all\n"
  conflicts:
    cmd: "git diff --name-only --diff-filter=U"
    usage: "Displays a nice list of files with merge conflicts in the current Git repo.\n"
  conflicts-fix:
    cmd: "git add .;git commit -m \"$2\";git pull -s recursive -X theirs origin $1"
    usage: "Fixes any potential merge conflicts. Has to be run before getting into a merge conflict. Runs through a normal git add, commit, pull command chain. \nExample: ahoy fix-conflicts <env> \"<message>\"\n"
  dbcc:
    cmd: "~/vendor/pantheon-systems/terminus/bin/terminus drush ${PWD##*/}.$1 -- updb -y;
    ~/vendor/pantheon-systems/terminus/bin/terminus drush ${PWD##*/}.$1 -- cr"
    usage: "Run Terminus Drush database update and cache clear for your current site folder. \nExample: ahoy dbcc <environment name>\n"
  d10-upgrade:
    cmd: "rm -rf composer.lock;
          composer remove drupal/console --no-update;
          composer remove drush/drush --no-update
          composer remove rvtraveller/qs-composer-installer --no-update;
          composer require composer/installers:^2 --no-update;
          composer require 'drupal/color:^1.0' --no-update;
          composer require 'drupal/rdf:^2.1' --no-update;
          chmod 777 web/sites/default;
          chmod 666 web/sites/default/*settings.php;
          chmod 666 web/sites/default/*services.yml;
          composer require 'drupal/core-recommended:^10' 'drupal/core-composer-scaffold:^10' 'drupal/core-project-message:^10' 'drupal/recommended-project:^10' --update-with-dependencies --no-update;
          composer require 'drush/drush:^11' 'drupal/csv_serialization:^3.0 || ^4.0' --no-update;
          ahoy total-update;
          chmod 755 web/sites/default;
          chmod 644 web/sites/default/*settings.php;
          chmod 644 web/sites/default/*services.yml;"
    usage: "Runs through a lot of commands to upgrade the site to Drupal 10. You will have to answer a question or two.\n"
  lenient:
    cmd: 'composer config --merge --json extra.drupal-lenient.allowed-list [\"drupal/$1\"]'
    usage: "Allow modules patched for Drupal 10 compliance to work when required via Composer. \nExample: ahoy lenient <module name>\n"
  login:
    cmd: "~/vendor/pantheon-systems/terminus/bin/terminus drush ${PWD##*/}.$1 -- uli $2"
    usage: "Create a one-time login to a website. \nExample: ahoy login <env> <username>\n"
  media-embed-update:
    cmd: "~/vendor/pantheon-systems/terminus/bin/terminus drush ${PWD##*/}.$1 -- ckeditor_media_embed:install -y"
    usage: "Update the CKEditor Media Embed plugins. Make sure the site is in SFTP and to run this on every environment. \nExample: ahoy media-embed-update <env>\n"
  sendup:
    cmd: "git add .;git commit -m \"$1\";git push"
    usage: "Run Git add, commit and push to your current site folder. \nExample: ahoy sendup \"<your commit message>\"\n"
  status:
    cmd: "composer outdated 'drupal/*'"
    usage: "Displays a list of all outdated modules and themes.\n"
  total-update:
    cmd: "composer update --with-dependencies;composer prepare-for-pantheon;composer install --no-dev --ignore-platform-reqs"
    usage: "Update Drupal modules and core. \nExample: ahoy total-update\n"
  up-pass:
    cmd: "~/vendor/pantheon-systems/terminus/bin/terminus drush ${PWD##*/}.$1 -- user:password $2 $3"
    usage: "Change a password for a user. You must locally be in a site directory.\nExample: ahoy up-pass <env> <user> <password>"