{{ attach_library('it_route_trip_tools/routes') }}
{{ attach_library('it_route_trip_tools/maps-autocomplete') }}
{{ attach_library('it_route_trip_tools/all-routes-map') }}
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqUxJwPyuHfnatPYCrCwLKjsAi5r7iRPI&location=47.044408,-122.901711&radius=2&strictbounds&libraries=places"
        defer></script>
<div class="container-fluid">
    <div class="col-xs-12 col-md-12" style="padding-left: 0; padding-right: 0; margin-top: 15px;">
        <div class="panel-group panel-default maps" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel-heading" role="tab" id="all-routes-map-heading">
                <h4 class="panel-title" style="position: relative;">
                    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#all-routes-map-body"
                       aria-expanded="true" aria-controls="all-routes-map-body"
                       class="panel-link-body"
                       onclick="document.querySelector('#map-toggle .chevron-down').style.transform === 'rotate(180deg)' 
                        ? document.querySelector('#map-toggle .chevron-down').style.transform = 'rotate(0deg)' 
                        : document.querySelector('#map-toggle .chevron-down').style.transform = 'rotate(180deg)'">
                          <span class="all-routes-route-map-toggle" id="map-toggle"><span class="chevron-down"></span></span>
                          <span class="show-map">Show Map</span>
                    </a>
                </h4>
            </div>
            <div id="all-routes-map-body" class="panel-collapse collapse" role="tabpanel"
                 aria-labelledby="all-routes-map-heading">
                <div id="route-map" class=" panel-body">
                    <div id="all-routes-map"></div>
                    <div id="tripplanner-menu" name="trip-planner-menu" style="display: none !important">
                        <div class="form-group">
                            <label for="start_add" class="sr-only">Starting Address</label>
                            <input type="text" name="start_add_id" id="start_add_id" class="hidden start-add-control"
                                   aria-hidden="true">
                            <div class="start-add-container">
                                <input name="start_add" id="start_add" type="text" placeholder="From"
                                       class="form-control start-add-control pac-target-input" autocomplete="off">
                                <button class="address-clear btn btn-danger" id="start-add-control" type="button">X
                                </button>
                            </div>
                            <div class="alert alert-danger hidden" id="start-add-alert"></div>
                            <button id="locate" class="btn btn-primary col-xs-12 col-sm-12 col-md-12 col-lg-12"
                                    type="button" onclick="showPosition();">Use My Location
                            </button>
                        </div>
                        <div class="form-group">
                            <label for="dest_add" class="sr-only">Destination Address</label>
                            <input type="text" name="dest_add_id" id="dest_add_id" class="hidden dest-add-control"
                                   aria-hidden="true">
                            <div class="dest-add-container">
                                <input name="dest_add" id="dest_add" type="text" placeholder="To"
                                       class="form-control dest-add-control pac-target-input" autocomplete="off">
                                <button class="address-clear btn btn-danger" id="dest-add-control" type="button">X
                                </button>
                            </div>
                            <div class="alert alert-danger hidden" id="dest-add-alert"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
</div>
<div class="container-fluid panel-container">
  <div class="col-xs-12 col-md-6 alerts-right-panel">
      <h2 class="routes-h2">Select a Bus Route</h2>
      <ul class="routes-container">
          {% for route_id, route_options in routes_options %}
              <li class="route-item" onclick="window.location.href = '/plan-your-trip/routes/{{ route_id }}'">
                  <a class="route-link" href="/plan-your-trip/routes/{{ route_id }}">
                      <span class="route-item-id">{{ route_options.id }}</span>
                      <span class="route-item-name">{{ route_options.name }}</span>
                  </a>
                  {% if route_options.alerts_content.length > 0 %}
                      <span class="route-item-alerts" data-toggle="modal" data-target="#alertsModal{{ route_id }}">
                            <img src="/modules/custom/it_route_trip_tools/assets/images/alert.svg" alt="Alerts"
                                style="width: 20px"/>
                            {{ route_options.alerts_content.length }}
                        </span>
                      <div class="modal fade" id="alertsModal{{ route_id }}" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                              <div class="modal-content">
                                  <div class="modal-header">
                                      <h4 class="modal-title" id="modalLabel">Alerts in Place</h4>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                      </button>
                                  </div>
                                  <div class="modal-body">
                                      {% for alert in route_options.alerts_content %}
                                          <div class="row container-fluid">
                                              <div class="col alert-severity">
                                                  <img src="/modules/custom/it_route_trip_tools/assets/images/{{ alert.field_severity.value is not empty ? alert.field_severity.value : 'warning' }}.svg" alt="{{alert.field_severity.value}}" />
                                              </div>
                                              <div class="col">
                                                  <p>
                                                      {{ alert.body.summary|raw }}
                                                  </p>
                                                  <a class="card-link" href="{{ path('entity.node.canonical', {node: alert.id}) }}">Read More<img class="card-arrow" style="margin-left: 10px" src="/modules/custom/it_route_trip_tools/assets/images/arrow.svg" /></a>
                                              </div>
                                          </div>
                                      {% endfor %}
                                  </div>
                                  <div class="modal-footer">
                                      <a class="btn btn-primary" id="view-all-alerts-breadcrumb" href="/alerts">
                                          <span aria-hidden="true">View All Alerts</span>
                                      </a>
                                  </div>
                              </div>
                          </div>
                      </div>

                  {% endif %}
                  <img class="card-arrow" style="float: right"
                      src="/modules/custom/it_route_trip_tools/assets/images/arrow.svg"/>
              </li>
          {% endfor %}
      </ul>
  </div>
  <div class="col-xs-12 col-md-6 alerts-left-panel">
      <h2><span class="routes-h2">Alerts <span class="hide-on-mobile">& Announcements</span></span>
          <span style="float: right;">
                  <a class="card-link" href="{{ alert_view_all_link }}">View All Alerts<img class="card-arrow"
                                                                                            src="/modules/custom/it_route_trip_tools/assets/images/arrow.svg"/></a>
              </span>
      </h2>
      <div id="accordion">
          {% for alert_id, alert in alert_options %}
              <div class="card">
                  <div class="card-header" id="heading{{ loop.index }}">
                      <h5 class="mb-0">
                          <img src="/modules/custom/it_route_trip_tools/assets/images/{{ alert.severity ? alert.severity : 'alert' }}.svg"
                              style="margin-left: -30px; margin-right: 20px; width: 24px"/>
                          <span class="alert-title">{{ alert.title }}</span>
                          <button class="btn btn-link alerts-collapse collapse collapsed" style="position:relative;margin-right:20px;display: block; margin-top: 8px;" data-toggle="collapse"
                                  data-target="#collapse{{ loop.index }}" aria-expanded="true"
                                  aria-controls="collapse{{ loop.index }}">
                              <figure></figure>
                          </button>
                      </h5>
                  </div>

                  <div id="collapse{{ loop.index }}" class="collapse" aria-labelledby="heading{{ loop.index }}"
                      data-parent="#accordion">
                      <div class="card-body">
                          {{ alert.description.value|raw }}
                      </div>
                  </div>
              </div>
          {% endfor %}
      </div>
  </div>
</div>