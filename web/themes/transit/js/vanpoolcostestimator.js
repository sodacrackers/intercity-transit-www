window.onload = function () {
    document.getElementById('passenger_count').addEventListener("change", function () {
        if (distance) {
            ReCalc();
        }
    })

    document.getElementById('days_per_week').addEventListener("change", function () {
        if (distance) {
            ReCalc();
        }
    })

}
var distance;

function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        mapTypeControl: false,
        zoom: 11,
        center: {
            lat: 47.0379,
            lng: -122.9007
        }
    });

    new AutocompleteDirectionsHandler(map);
}

function AutocompleteDirectionsHandler(map) {
    var originAutocomplete = new google.maps.places.Autocomplete(
            document.getElementById('saddr'), {
        placeIdOnly: true
    });
    var destinationAutocomplete = new google.maps.places.Autocomplete(
            document.getElementById('daddr'), {
        placeIdOnly: true
    });
    this.map = map;
    this.originPlaceId = null;
    this.destinationPlaceId = null;
    this.travelMode = 'DRIVING';
    this.directionsService = new google.maps.DirectionsService;
    this.directionsDisplay = new google.maps.DirectionsRenderer({
        draggable: true,
        map: map
    });

    this.setupPlaceChangedListener(originAutocomplete, 'ORIG');
    this.setupPlaceChangedListener(destinationAutocomplete, 'DEST');

}

AutocompleteDirectionsHandler.prototype.setupPlaceChangedListener = function (autocomplete, mode) {
    var me = this;
    autocomplete.bindTo('bounds', this.map);
    autocomplete.addListener('place_changed', function () {
        var place = autocomplete.getPlace();
        if (!place.place_id) {
            window.alert("Please select an option from the dropdown list.");
            return;
        }
        if (mode === 'ORIG') {
            me.originPlaceId = place.place_id;
        } else {
            me.destinationPlaceId = place.place_id;
        }
        me.route();
    });
};

AutocompleteDirectionsHandler.prototype.route = function () {
    var me = this;
    if (!this.originPlaceId || !this.destinationPlaceId) {
        return;
    }

    this.directionsService.route({
        origin: {
            'placeId': this.originPlaceId
        },
        destination: {
            'placeId': this.destinationPlaceId
        },
        travelMode: this.travelMode
    }, function (response, status) {
        if (status === 'OK') {
            me.directionsDisplay.setDirections(response);
            computeTotalDistance(me.directionsDisplay.getDirections());
            me.directionsDisplay.addListener('directions_changed', function () {
                computeTotalDistance(me.directionsDisplay.getDirections());
            });
        } else {
            window.alert('Directions request failed due to ' + status);
        }
    });
};

function computeTotalDistance(result) {
    var total = 0;
    var myroute = result.routes[0];
    for (var i = 0; i < myroute.legs.length; i++) {
        total += myroute.legs[i].distance.value;
    }
    total = total / 1609; //converts meters per mile.
    total = total.toFixed(2); // rounds decimal value to nearest 100th.
    distance = total;
    ReCalc();

}


function ReCalc() {
    var passengers = parseFloat(document.getElementById('passenger_count').value);
    var days = parseFloat(document.getElementById('days_per_week').value);
    var roundtrip = distance * 2

    document.getElementById('distance').innerHTML = (roundtrip + " miles");

    if (roundtrip < 200) { //mileage chart pricing only goes to 200 miles.
        for (var i = 0; i < vanpoolfares.length; i++) {
            if (vanpoolfares[i][0] == days) {
                if ((roundtrip >= vanpoolfares[i][1]) && (roundtrip < vanpoolfares[i][2])) {

                    document.getElementById('cost').innerHTML = ("$" + vanpoolfares[i][passengers - 2] + ".00");
                }
            }
        }
    } else {
        document.getElementById('cost').innerHTML = ("N/A");
    }
}

//column 1 is number of days per week. 
//column 2 is low end of distance range. 
//column 3 is high end of distance range.
//column 4-11 ares cost per passenger, based on the number of passengers, starting at 5 and going up to 15.
var vanpoolfares = [
    [4, 0, 20, 65, 55, 48, 43, 42, 41, 40, 39, 38, 36, 35],
    [4, 20, 25, 73, 61, 53, 48, 45, 44, 43, 42, 41, 38, 36],
    [4, 25, 30, 81, 67, 59, 52, 49, 48, 46, 43, 42, 40, 37],
    [4, 30, 35, 88, 73, 64, 57, 52, 51, 49, 45, 44, 42, 39],
    [4, 35, 40, 94, 78, 70, 62, 57, 55, 53, 49, 48, 45, 42],
    [4, 40, 45, 98, 82, 73, 67, 61, 60, 57, 52, 51, 48, 45],
    [4, 45, 50, 103, 86, 77, 73, 67, 65, 62, 57, 55, 51, 49],
    [4, 50, 55, 107, 89, 80, 78, 72, 70, 66, 62, 58, 55, 52],
    [4, 55, 60, 112, 93, 83, 81, 75, 73, 70, 65, 61, 58, 55],
    [4, 60, 65, 117, 97, 87, 85, 78, 76, 74, 68, 63, 60, 58],
    [4, 65, 70, 122, 102, 91, 89, 82, 80, 77, 72, 66, 64, 61],
    [4, 70, 75, 127, 106, 94, 91, 85, 83, 80, 76, 69, 66, 63],
    [4, 75, 80, 129, 108, 96, 93, 87, 85, 83, 78, 71, 68, 66],
    [4, 80, 85, 133, 111, 99, 96, 89, 88, 85, 80, 73, 70, 67],
    [4, 85, 90, 137, 114, 102, 99, 93, 91, 88, 83, 75, 71, 68],
    [4, 90, 95, 139, 116, 105, 102, 96, 94, 90, 85, 77, 73, 71],
    [4, 95, 100, 146, 122, 108, 106, 100, 98, 93, 88, 80, 77, 74],
    [4, 100, 105, 151, 126, 111, 109, 103, 101, 95, 92, 83, 80, 76],
    [4, 105, 110, 154, 129, 114, 111, 105, 103, 98, 94, 86, 81, 78],
    [4, 110, 115, 158, 132, 117, 114, 108, 106, 102, 96, 87, 82, 79],
    [4, 115, 120, 162, 135, 120, 117, 111, 109, 105, 99, 89, 85, 81],
    [4, 120, 125, 166, 138, 122, 120, 114, 112, 108, 102, 92, 88, 85],
    [4, 125, 130, 168, 140, 124, 122, 116, 114, 109, 104, 95, 90, 88],
    [4, 130, 135, 174, 145, 128, 126, 120, 118, 112, 106, 97, 93, 89],
    [4, 135, 140, 177, 148, 131, 128, 123, 121, 115, 108, 99, 95, 91],
    [4, 140, 145, 181, 151, 133, 131, 125, 123, 118, 111, 101, 97, 93],
    [4, 145, 150, 185, 154, 136, 134, 128, 126, 121, 114, 104, 101, 97],
    [4, 150, 155, 188, 157, 138, 136, 131, 129, 124, 116, 107, 103, 100],
    [4, 155, 160, 192, 160, 141, 139, 133, 132, 126, 119, 109, 105, 101],
    [4, 160, 165, 196, 164, 144, 142, 136, 134, 129, 122, 111, 107, 103],
    [4, 165, 170, 199, 166, 146, 144, 139, 137, 132, 124, 113, 109, 105],
    [4, 170, 175, 204, 170, 149, 147, 142, 140, 135, 126, 115, 111, 106],
    [4, 175, 180, 208, 173, 152, 150, 145, 143, 138, 129, 117, 113, 108],
    [4, 180, 185, 210, 175, 154, 152, 147, 145, 140, 131, 119, 114, 110],
    [4, 185, 190, 212, 177, 155, 153, 149, 147, 142, 133, 122, 116, 112],
    [4, 190, 195, 214, 178, 157, 155, 151, 149, 143, 134, 123, 118, 113],
    [4, 195, 200, 217, 181, 158, 156, 153, 151, 145, 135, 125, 120, 115],
    [5, 0, 20, 69, 58, 50, 44, 43, 42, 40, 37, 36, 35, 33],
    [5, 20, 25, 79, 66, 58, 51, 47, 46, 45, 41, 40, 39, 36],
    [5, 25, 30, 88, 73, 64, 57, 52, 51, 49, 45, 43, 42, 39],
    [5, 30, 35, 95, 79, 71, 64, 58, 56, 54, 49, 47, 46, 43],
    [5, 35, 40, 100, 83, 74, 69, 63, 61, 58, 53, 52, 49, 46],
    [5, 40, 45, 105, 87, 78, 76, 68, 66, 64, 59, 56, 53, 50],
    [5, 45, 50, 110, 92, 82, 81, 74, 72, 68, 64, 60, 57, 53],
    [5, 50, 55, 116, 96, 86, 85, 77, 75, 73, 68, 62, 59, 57],
    [5, 55, 60, 122, 102, 91, 89, 82, 80, 77, 72, 66, 64, 61],
    [5, 60, 65, 128, 106, 94, 91, 85, 83, 81, 77, 70, 66, 64],
    [5, 65, 70, 130, 108, 96, 93, 87, 85, 84, 79, 72, 69, 67],
    [5, 70, 75, 136, 114, 101, 98, 92, 90, 87, 82, 74, 70, 68],
    [5, 75, 80, 140, 117, 104, 102, 96, 94, 89, 85, 76, 73, 70],
    [5, 80, 85, 146, 122, 108, 106, 100, 98, 93, 88, 80, 77, 74],
    [5, 85, 90, 151, 126, 111, 109, 103, 101, 95, 92, 83, 80, 76],
    [5, 90, 95, 155, 129, 114, 112, 106, 104, 99, 95, 86, 82, 78],
    [5, 95, 100, 160, 133, 118, 116, 110, 108, 103, 97, 87, 83, 79],
    [5, 100, 105, 165, 138, 122, 119, 113, 110, 107, 101, 91, 87, 83],
    [5, 105, 110, 167, 139, 124, 121, 115, 112, 109, 104, 94, 90, 87],
    [5, 110, 115, 174, 145, 128, 126, 120, 118, 112, 106, 97, 93, 89],
    [5, 115, 120, 178, 149, 131, 129, 123, 120, 116, 109, 100, 95, 91],
    [5, 120, 125, 183, 152, 134, 132, 126, 123, 119, 112, 102, 98, 94],
    [5, 125, 130, 186, 155, 137, 135, 129, 125, 122, 115, 106, 102, 99],
    [5, 130, 135, 190, 159, 140, 138, 132, 129, 125, 118, 108, 104, 101],
    [5, 135, 140, 196, 163, 143, 141, 136, 133, 129, 121, 111, 106, 103],
    [5, 140, 145, 199, 166, 146, 144, 139, 136, 132, 124, 113, 109, 105],
    [5, 145, 150, 205, 171, 150, 148, 143, 139, 135, 126, 116, 111, 107],
    [5, 150, 155, 209, 174, 153, 151, 146, 142, 139, 130, 118, 113, 109],
    [5, 155, 160, 211, 176, 155, 153, 149, 145, 141, 132, 121, 115, 111],
    [5, 160, 165, 213, 178, 157, 155, 151, 147, 143, 134, 123, 117, 113],
    [5, 165, 170, 217, 181, 158, 156, 153, 149, 145, 135, 125, 120, 115],
    [5, 170, 175, 219, 182, 160, 158, 154, 150, 147, 137, 127, 122, 117],
    [5, 175, 180, 221, 185, 162, 160, 157, 153, 149, 139, 129, 124, 119],
    [5, 180, 185, 223, 187, 165, 163, 159, 155, 151, 142, 131, 126, 121],
    [5, 185, 190, 226, 189, 167, 165, 161, 157, 154, 144, 134, 128, 124],
    [5, 190, 195, 228, 191, 169, 167, 163, 160, 156, 146, 136, 130, 126],
    [5, 195, 200, 230, 193, 171, 169, 165, 161, 158, 148, 138, 133, 128],
    [6, 0, 20, 79, 66, 58, 51, 48, 47, 45, 42, 40, 39, 36],
    [6, 20, 25, 90, 75, 66, 58, 54, 52, 50, 46, 45, 43, 40],
    [6, 25, 30, 97, 81, 73, 66, 61, 59, 56, 51, 50, 47, 45],
    [6, 30, 35, 103, 86, 77, 74, 68, 66, 62, 58, 55, 52, 49],
    [6, 35, 40, 110, 92, 82, 80, 75, 72, 68, 64, 60, 57, 53],
    [6, 40, 45, 117, 98, 87, 85, 79, 77, 74, 69, 63, 61, 58],
    [6, 45, 50, 125, 104, 92, 90, 84, 82, 79, 74, 68, 65, 62],
    [6, 50, 55, 129, 108, 96, 93, 87, 85, 83, 78, 72, 69, 66],
    [6, 55, 60, 136, 114, 101, 98, 92, 90, 87, 82, 74, 70, 68],
    [6, 60, 65, 140, 116, 105, 102, 96, 94, 90, 85, 77, 74, 71],
    [6, 65, 70, 149, 124, 110, 107, 101, 99, 94, 90, 82, 78, 75],
    [6, 70, 75, 154, 128, 113, 111, 105, 103, 98, 94, 86, 81, 78],
    [6, 75, 80, 160, 133, 118, 116, 110, 108, 103, 97, 87, 83, 79],
    [6, 80, 85, 166, 138, 122, 120, 114, 112, 107, 102, 92, 88, 84],
    [6, 85, 90, 171, 142, 126, 124, 118, 116, 111, 105, 96, 91, 88],
    [6, 90, 95, 177, 148, 130, 128, 122, 120, 115, 108, 99, 94, 91],
    [6, 95, 100, 183, 152, 134, 132, 126, 124, 119, 112, 102, 98, 94],
    [6, 100, 105, 187, 156, 137, 135, 130, 128, 123, 116, 106, 103, 99],
    [6, 105, 110, 193, 161, 141, 139, 135, 133, 127, 119, 109, 105, 102],
    [6, 110, 115, 198, 165, 145, 143, 139, 137, 131, 123, 112, 109, 104],
    [6, 115, 120, 205, 171, 150, 148, 144, 142, 135, 126, 116, 111, 107],
    [6, 120, 125, 210, 175, 153, 151, 147, 145, 139, 131, 119, 114, 109],
    [6, 125, 130, 212, 177, 156, 154, 150, 148, 142, 133, 122, 116, 112],
    [6, 130, 135, 216, 180, 158, 156, 153, 151, 145, 135, 124, 119, 114],
    [6, 135, 140, 219, 182, 160, 158, 155, 153, 147, 137, 127, 122, 117],
    [6, 140, 145, 221, 185, 162, 160, 157, 155, 149, 139, 129, 124, 119],
    [6, 145, 150, 223, 187, 165, 163, 159, 157, 151, 142, 131, 126, 121],
    [6, 150, 155, 226, 189, 167, 165, 161, 160, 154, 144, 134, 128, 124],
    [6, 155, 160, 228, 191, 169, 167, 163, 161, 156, 146, 136, 130, 126],
    [6, 160, 165, 230, 193, 171, 169, 165, 163, 158, 148, 138, 133, 128],
    [6, 165, 170, 232, 195, 173, 171, 167, 165, 160, 150, 140, 135, 130],
    [6, 170, 175, 234, 197, 175, 173, 169, 167, 162, 152, 142, 137, 132],
    [6, 175, 180, 236, 199, 177, 175, 171, 169, 164, 154, 144, 139, 134],
    [6, 180, 185, 238, 201, 179, 177, 173, 171, 166, 156, 146, 141, 136],
    [6, 185, 190, 240, 203, 181, 179, 175, 173, 168, 158, 148, 143, 138],
    [6, 190, 195, 242, 205, 183, 181, 177, 175, 170, 160, 150, 145, 140],
    [6, 195, 200, 244, 207, 185, 183, 179, 177, 172, 162, 152, 147, 142],
    [7, 0, 20, 88, 73, 64, 57, 52, 51, 49, 45, 44, 42, 39],
    [7, 20, 25, 96, 80, 72, 65, 60, 58, 55, 51, 50, 47, 44],
    [7, 25, 30, 103, 86, 77, 74, 68, 66, 62, 58, 55, 52, 49],
    [7, 30, 35, 112, 93, 83, 82, 75, 73, 70, 65, 61, 58, 55],
    [7, 35, 40, 120, 100, 89, 88, 81, 79, 76, 71, 65, 63, 60],
    [7, 40, 45, 128, 107, 95, 92, 86, 84, 82, 77, 71, 67, 64],
    [7, 45, 50, 134, 112, 99, 97, 90, 88, 86, 81, 73, 70, 67],
    [7, 50, 55, 138, 115, 104, 101, 95, 93, 89, 85, 76, 73, 70],
    [7, 55, 60, 149, 124, 110, 107, 101, 99, 94, 90, 82, 78, 75],
    [7, 60, 65, 155, 129, 114, 112, 106, 104, 99, 95, 86, 82, 78],
    [7, 65, 70, 162, 135, 120, 117, 111, 109, 105, 99, 89, 85, 81],
    [7, 70, 75, 167, 139, 124, 121, 115, 113, 109, 104, 94, 90, 87],
    [7, 75, 80, 175, 146, 129, 127, 121, 119, 113, 107, 98, 94, 90],
    [7, 80, 85, 182, 151, 133, 131, 125, 123, 118, 111, 101, 97, 94],
    [7, 85, 90, 187, 156, 137, 135, 130, 128, 123, 116, 106, 103, 99],
    [7, 90, 95, 194, 162, 142, 140, 135, 133, 128, 120, 110, 106, 102],
    [7, 95, 100, 199, 166, 146, 144, 140, 138, 132, 124, 113, 109, 105],
    [7, 100, 105, 208, 173, 152, 150, 146, 144, 138, 129, 117, 113, 108],
    [7, 105, 110, 211, 176, 155, 153, 149, 147, 141, 132, 121, 115, 111],
    [7, 110, 115, 215, 179, 157, 155, 152, 150, 144, 135, 124, 118, 114],
    [7, 115, 120, 219, 182, 160, 158, 155, 153, 147, 137, 127, 122, 117],
    [7, 120, 125, 221, 185, 162, 160, 157, 155, 149, 139, 129, 124, 119],
    [7, 125, 130, 223, 187, 165, 163, 159, 157, 151, 142, 131, 126, 121],
    [7, 130, 135, 226, 189, 167, 165, 161, 160, 154, 144, 134, 128, 124],
    [7, 135, 140, 228, 191, 169, 167, 163, 161, 156, 146, 136, 130, 126],
    [7, 140, 145, 230, 193, 171, 169, 165, 163, 158, 148, 138, 133, 128],
    [7, 145, 150, 232, 195, 173, 171, 167, 165, 160, 150, 140, 135, 130],
    [7, 150, 155, 234, 197, 175, 173, 169, 167, 162, 152, 142, 137, 132],
    [7, 155, 160, 236, 199, 177, 175, 171, 169, 164, 154, 144, 139, 134],
    [7, 160, 165, 238, 201, 179, 177, 173, 171, 166, 156, 146, 141, 136],
    [7, 165, 170, 240, 203, 181, 179, 175, 173, 168, 158, 148, 143, 138],
    [7, 170, 175, 242, 205, 183, 181, 177, 175, 170, 160, 150, 145, 140],
    [7, 175, 180, 244, 207, 185, 183, 179, 177, 172, 162, 152, 147, 142],
    [7, 180, 185, 246, 209, 187, 185, 181, 179, 174, 164, 154, 149, 144],
    [7, 185, 190, 248, 211, 189, 187, 183, 181, 176, 166, 156, 151, 146],
    [7, 190, 195, 250, 213, 191, 189, 185, 183, 178, 168, 158, 153, 148],
    [7, 195, 200, 252, 215, 193, 191, 187, 185, 180, 170, 160, 155, 150],
    [9, 0, 20, 68, 57, 49, 44, 41, 40, 39, 38, 36, 35, 32],
    [9, 20, 25, 77, 64, 56, 50, 46, 45, 43, 42, 41, 38, 35],
    [9, 25, 30, 86, 72, 63, 56, 51, 50, 48, 45, 44, 41, 38],
    [9, 30, 35, 93, 78, 69, 62, 57, 55, 53, 49, 48, 45, 42],
    [9, 35, 40, 98, 82, 73, 67, 62, 60, 57, 52, 51, 48, 45],
    [9, 40, 45, 103, 86, 77, 73, 67, 65, 62, 57, 55, 51, 49],
    [9, 45, 50, 108, 90, 81, 79, 72, 70, 66, 62, 58, 56, 52],
    [9, 50, 55, 113, 94, 84, 82, 77, 75, 71, 66, 61, 58, 56],
    [9, 55, 60, 119, 99, 88, 86, 80, 78, 75, 70, 64, 62, 59],
    [9, 60, 65, 124, 104, 92, 90, 83, 81, 79, 74, 68, 65, 62],
    [9, 65, 70, 128, 107, 95, 92, 86, 84, 82, 77, 71, 68, 65],
    [9, 70, 75, 132, 110, 98, 95, 89, 87, 85, 80, 73, 70, 67],
    [9, 75, 80, 137, 114, 102, 99, 93, 91, 88, 83, 75, 71, 68],
    [9, 80, 85, 139, 116, 105, 102, 96, 94, 90, 85, 77, 73, 71],
    [9, 85, 90, 147, 123, 109, 106, 100, 98, 93, 89, 81, 77, 74],
    [9, 90, 95, 151, 126, 112, 109, 103, 101, 96, 92, 84, 80, 76],
    [9, 95, 100, 155, 129, 114, 112, 106, 104, 99, 95, 86, 82, 78],
    [9, 100, 105, 160, 133, 118, 116, 110, 108, 103, 97, 87, 83, 79],
    [9, 105, 110, 165, 138, 122, 119, 113, 111, 107, 101, 91, 87, 83],
    [9, 110, 115, 167, 139, 124, 121, 115, 113, 109, 104, 94, 90, 87],
    [9, 115, 120, 173, 144, 127, 125, 119, 117, 112, 106, 97, 92, 89],
    [9, 120, 125, 177, 148, 130, 128, 123, 121, 115, 108, 99, 95, 91],
    [9, 125, 130, 182, 151, 133, 131, 126, 124, 118, 111, 101, 97, 94],
    [9, 130, 135, 185, 154, 136, 134, 128, 126, 121, 114, 105, 101, 98],
    [9, 135, 140, 189, 157, 139, 137, 131, 129, 124, 117, 107, 104, 100],
    [9, 140, 145, 194, 161, 142, 140, 135, 133, 127, 120, 109, 105, 102],
    [9, 145, 150, 198, 165, 145, 143, 138, 136, 131, 123, 112, 108, 104],
    [9, 150, 155, 202, 169, 148, 146, 142, 140, 134, 125, 115, 111, 106],
    [9, 155, 160, 207, 172, 151, 149, 145, 143, 137, 128, 117, 112, 108],
    [9, 160, 165, 210, 175, 153, 151, 148, 146, 140, 131, 119, 114, 110],
    [9, 165, 170, 212, 177, 155, 153, 150, 148, 142, 133, 122, 116, 112],
    [9, 170, 175, 215, 179, 157, 155, 152, 150, 144, 135, 124, 118, 114],
    [9, 175, 180, 217, 181, 159, 157, 154, 152, 146, 136, 125, 120, 116],
    [9, 180, 185, 219, 182, 160, 158, 154, 153, 147, 137, 127, 122, 117],
    [9, 185, 190, 221, 185, 162, 160, 157, 155, 149, 139, 129, 124, 119],
    [9, 190, 195, 223, 187, 165, 163, 159, 157, 151, 142, 131, 126, 121],
    [9, 195, 200, 226, 189, 167, 165, 161, 159, 154, 144, 134, 128, 124]
];